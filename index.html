<!DOCTYPE html>
<html lang="ar">
  
<head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#ffffff">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <title>Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø³ÙƒØ±</title>
  <style>
    body { font-family: 'Tahoma', sans-serif; direction: rtl; background-color: #f7f9fc; color: #333; padding: 1rem; }
    input, select, button, textarea {
      padding: 0.5rem;
      margin: 0.5rem 0;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }
button {
  border: none;
  cursor: pointer;
  transition: background-color 0.3s, box-shadow 0.3s;
  font-size: 1.1rem;
  font-weight: bold;
  padding: 0.75rem;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

button:hover {
  box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
}

.save-btn { background-color: #d1fae5; color: #000; }
.save-btn:hover { background-color: #a7f3d0; }
.save-btn::before { content: "ğŸ’¾ "; }

.now-btn { background-color: #e0f2fe; color: #000; }
.now-btn:hover { background-color: #bae6fd; }
.now-btn::before { content: "â° "; }

.clear-btn { background-color: #fef9c3; color: #000; }
.clear-btn:hover { background-color: #fef08a; }
.clear-btn::before { content: "ğŸ—‘ï¸ "; }

.pdf-btn { background-color: #e5e7eb; color: #000; }
.pdf-btn:hover { background-color: #d1d5db; }
.pdf-btn::before { content: "ğŸ“„ "; }

.delete-btn {
  background-color: #e2e8f0;
  color: #1f2937;
  font-size: 1rem;
  font-weight: bold;
  padding: 0.5rem;
  border-radius: 6px;
  margin-top: 0.5rem;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}
.delete-btn::before { content: "âœ–ï¸ "; }



    .reading {
      background-color: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      margin: 0.5rem 0;
      padding: 0.75rem;
      box-shadow: 1px 1px 5px rgba(0,0,0,0.05);
    }
    .button-row {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }
  </style>
</head>
<body>
  <h2>  ØªØªØ¨Ø¹ Ù‚Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø³ÙƒØ±</h2>

  <label for="sugar">Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³ÙƒØ± (mg/dL):</label>
  <input type="number" id="sugar" placeholder="Ù…Ø«Ù„Ø§Ù‹ 110">

  <label for="timing">ÙˆÙ‚Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©:</label>
  <select id="timing">
    <option value="Ù‚Ø¨Ù„ Ø§Ù„Ø£ÙƒÙ„">Ù‚Ø¨Ù„ Ø§Ù„Ø£ÙƒÙ„</option>
    <option value="Ø¨Ø¹Ø¯ Ø§Ù„Ø£ÙƒÙ„">Ø¨Ø¹Ø¯ Ø§Ù„Ø£ÙƒÙ„</option>
  </select>

  <label for="customDate">Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
  <input type="datetime-local" id="customDate">
  <button class="now-btn" onclick="setNow()">Ø§Ù„Ø¢Ù†</button>

  <label for="note">Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
  <textarea id="note" rows="2" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø£ÙƒÙ„ Ø¹Ø¯Ø³ ÙˆÙƒÙˆØ³Ø© Ø£Ùˆ Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø´ÙŠ"></textarea>

  <div class="button-row">
    <button class="save-btn" onclick="saveReading()">Ø­ÙØ¸ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</button>
    <button class="clear-btn" onclick="clearAll()">Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>
    <button class="pdf-btn" onclick="exportPDF()">ØªØµØ¯ÙŠØ± PDF</button>
  </div>

  <h3>Ø¢Ø®Ø± Ø§Ù„Ù‚Ø±Ø§Ø¡Ø§Øª</h3>
  <div id="history"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const limit = 50;

    function saveReading() {
      const value = parseInt(document.getElementById('sugar').value);
      const timing = document.getElementById('timing').value;
      const note = document.getElementById('note').value;
      const customDate = document.getElementById('customDate').value;
      const time = customDate ? new Date(customDate).toLocaleString() : new Date().toLocaleString();

      if (!value) return alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø©.');

      const readings = JSON.parse(localStorage.getItem('readings') || '[]');
      readings.unshift({ value, timing, note, time });
      if (readings.length > limit) readings.pop();
      localStorage.setItem('readings', JSON.stringify(readings));
      renderReadings();

      document.getElementById('sugar').value = '';
      document.getElementById('note').value = '';
      document.getElementById('customDate').value = '';
    }

   function setNow() {
  const now = new Date();
  const offset = now.getTimezoneOffset() * 60000; // ÙØ±Ù‚ Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø¨Ø§Ù„Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©
  const localISOTime = new Date(now - offset).toISOString().slice(0, 16); // YYYY-MM-DDTHH:MM
  document.getElementById('customDate').value = localISOTime;
}

    function renderReadings() {
      const readings = JSON.parse(localStorage.getItem('readings') || '[]');
      const history = document.getElementById('history');
      history.innerHTML = readings.map((r, i) => `
        <div class="reading">
          <strong>${r.time}</strong><br>
          ${r.value} mg/dL <em>(${r.timing})</em><br>
          ${r.note ? `<small>ğŸ“ ${r.note}</small><br>` : ''}
          <button onclick="editReading(${i})">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="delete-btn" onclick="deleteReading(${i})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
        </div>
      `).join('');
    }

    function deleteReading(index) {
      const readings = JSON.parse(localStorage.getItem('readings') || '[]');
      readings.splice(index, 1);
      localStorage.setItem('readings', JSON.stringify(readings));
      renderReadings();
    }

    function clearAll() {
      if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø§ØªØŸ')) {
        localStorage.removeItem('readings');
        renderReadings();
      }
    }

function exportPDF() {
  const readings = JSON.parse(localStorage.getItem('readings') || '[]');

  if (readings.length === 0) {
    alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø±Ø§Ø¡Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©.");
    return;
  }

  let exportContainer = document.getElementById("pdf-export-temp");
  if (exportContainer) exportContainer.remove();

  exportContainer = document.createElement("div");
  exportContainer.id = "pdf-export-temp";
  exportContainer.style.position = "static"; 
  exportContainer.style.width = "21cm";
  exportContainer.style.padding = "2cm";
  exportContainer.style.fontFamily = "Tahoma, Arial, sans-serif";
  exportContainer.setAttribute("dir", "rtl");

  let content = `<h2 style="text-align:center;">  ØªÙ‚Ø±ÙŠØ± Ù‚Ø±Ø§Ø¡Ø§Øª Ø³ÙƒØ± Ø¨Ø§Ø¨Ø§  </h2>`;
  readings.forEach((r, i) => {
    content += `
      <div style="margin-bottom: 20px; page-break-inside: avoid;">
        <strong>${i + 1}. ${r.time}</strong><br>
        <span>   Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©  ${r.value}  - ${r.timing}</span><br>
        ${r.note ? `<em>ğŸ“ ${r.note}</em>` : ''}
      </div>
    `;
  });

  exportContainer.innerHTML = content;
  document.body.appendChild(exportContainer);

  // Ù†Ù†ØªØ¸Ø± Ù„ÙŠØ±Ø³Ù… Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ù†Øµ Ù‚Ø¨Ù„ Ø§Ù„ØªØµØ¯ÙŠØ±
  setTimeout(() => {
    html2pdf().set({
      margin: [10, 10, 10, 10],
      filename: "ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ø³ÙƒØ±.pdf",
      html2canvas: { scale: 2 },
      jsPDF: { unit: "mm", format: "a4", orientation: "portrait" }
    })
    .from(exportContainer)
    .save()
    .then(() => {
      document.body.removeChild(exportContainer);
    });
  }, 100); // ÙƒØ§ÙÙŠØ© Ù„Ù„Ø±Ø³Ù…
}




    function editReading(index) {
      const readings = JSON.parse(localStorage.getItem('readings') || '[]');
      const item = readings[index];
      const newVal = prompt('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©:', item.value);
      const newTiming = prompt('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª (Ù‚Ø¨Ù„ Ø§Ù„Ø£ÙƒÙ„ / Ø¨Ø¹Ø¯ Ø§Ù„Ø£ÙƒÙ„):', item.timing);
      const newNote = prompt('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©:', item.note);
      const newTime = prompt('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª:', item.time);
      if (newVal && !isNaN(newVal)) {
        readings[index] = {
          value: parseInt(newVal),
          timing: newTiming || item.timing,
          note: newNote || '',
          time: newTime || item.time
        };
        localStorage.setItem('readings', JSON.stringify(readings));
        renderReadings();
      }
    }

    window.addEventListener('load', () => {
      renderReadings();
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js');
      }
    });
  </script>
</body>
</html>
